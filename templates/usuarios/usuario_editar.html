{# apps/usuarios/templates/usuarios/usuario_editar.html #}
{% extends 'base.html' %}

{% block title %}Editar Usuario{% endblock title %}

{% block contenido %}
<div class="container mt-4">
    <div class="card p-4 shadow-sm">
        {# object.username es el usuario que estamos editando #}
        <h2 class="card-title text-center mb-4">Editar Usuario: **{{ object.username }}**</h2>

        <form method="post">
            {% csrf_token %} {# ¡Importante para la seguridad de Django! #}

            {# Bucle para renderizar todos los campos del formulario #}
            {% for field in form %}
                <div class="mb-3">
                    {{ field.label_tag }} {# Etiqueta del campo #}
                    {{ field }} {# El campo de entrada #}
                    {% if field.help_text %}
                        <div class="form-text text-muted">{{ field.help_text }}</div>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="alert alert-danger mt-1">{{ error }}</div>
                    {% endfor %}
                </div>
            {% endfor %}

            {# Mensajes de errores no relacionados con campos específicos (ej. si algo falla a nivel de formulario) #}
            {% if form.non_field_errors %}
                <div class="alert alert-danger mt-3">
                    {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <a href="{% url 'usuarios:lista_usuarios' %}" class="btn btn-secondary me-2">Cancelar</a>
                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </div>
        </form>
    </div>
</div>
{% endblock contenido %}

{% block extra_js %}
<script>
    // Script para añadir clases de Bootstrap a los campos del formulario
    document.addEventListener('DOMContentLoaded', function() {
        var formFields = document.querySelectorAll('input, select, textarea');
        formFields.forEach(function(field) {
            // Evitar aplicar a campos ocultos o botones de submit
            if (field.type !== 'hidden' && field.type !== 'submit') {
                field.classList.add('form-control');
            }
            // Para checkboxes, el estilo es diferente en Bootstrap
            if (field.type === 'checkbox') {
                field.classList.remove('form-control'); // Remover si se añadió por error
                field.classList.add('form-check-input');
                var div = field.closest('.mb-3'); // Buscar el contenedor mb-3
                if (div) {
                    div.classList.add('form-check'); // Añadir clase para estilo de checkbox
                    var label = div.querySelector('label');
                    if (label) {
                        label.classList.add('form-check-label');
                        // Mover la etiqueta después del input para el estilo `form-check` de Bootstrap
                        field.parentNode.insertBefore(label, field); // Esto si la etiqueta está ANTES del input
                        // O si la etiqueta es hermana del input y quieres mantener el orden:
                        // label.parentNode.insertBefore(field, label);
                    }
                }
            }
        });
    });
</script>
{% endblock extra_js %}